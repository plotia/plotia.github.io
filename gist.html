<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>GIST Grid Viewer</title>
  <script src="https://unpkg.com/ngl@latest/dist/ngl.js"></script>
  <style>
    #viewport { width: 100%; height: 600px; }
    .btn { margin: 5px; padding: 8px 12px; font-size: 14px; }
  </style>
</head>
<body>

<div id="viewport"></div>
<button class="btn" onclick="showMap('esw')">Show ESW Grid</button>
<button class="btn" onclick="showMap('strans')">Show Strans Grid</button>
<button class="btn" onclick="showMap('sorient')">Show Sorient Grid</button>

<script>
  const stage = new NGL.Stage("viewport");

  // Load PDB as licorice
  stage.loadFile("frame1_2vom.pdb").then(function(comp) {
    comp.addRepresentation("licorice", { multipleBond: true });
    comp.autoView();
  });

  // Grid map configuration
  const maps = {
    esw: {
      file: "gist-Esw-dens_2VOM.dx",
      colorMap: "red-white-blue", // diverging colormap
      min: -0.01,
      max:  0.01
    },
    strans: {
      file: "gist-dTStrans-dens_2VOM.dx",
      colorMap: "blue-red",
      min: -0.01,
      max:  0.01
    },
    sorient: {
      file: "gist-dTSorient-dens_2VOM.dx",
      colorMap: "green",
      min: -0.01,
      max:  0.01
    }
  };

  let currentGrid = null;

  function showMap(type) {
    // Remove existing grid
    if (currentGrid) {
      stage.removeComponent(currentGrid);
      currentGrid = null;
    }

    const cfg = maps[type];
    console.log("Loading grid:", cfg.file);

    stage.loadFile(cfg.file, { defaultRepresentation: false }).then(function(o) {
      currentGrid = o;
      o.addRepresentation("volume", {
        isolevelType: "value",
        colorScheme: cfg.colorMap,
        opacity: 0.5,
        minValue: cfg.min,
        maxValue: cfg.max,
        useWorker: false
      });
    }).catch(function(err) {
      console.error("Failed to load:", cfg.file, err);
      alert("Could not load grid: " + cfg.file);
    });
  }
</script>

</body>
</html>
